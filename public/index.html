<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snake.io Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }

        body {
            background-color: #f0f0f0;
            overflow: hidden;
        }

        /* Auth container styles */
        #auth-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, #111, #333);
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #auth-menu {
            background-color: rgba(255, 255, 255, 0.9);
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            width: 350px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }

        #auth-menu h1 {
            color: #4CAF50;
            margin-bottom: 25px;
            font-size: 42px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        #auth-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        #auth-form input {
            padding: 12px;
            width: 100%;
            border: 2px solid #4CAF50;
            border-radius: 5px;
            font-size: 16px;
            outline: none;
        }

        #auth-form button {
            padding: 12px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }

        #auth-form button:hover {
            background-color: #45a049;
        }

        #signup-form, #login-form {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        #login-form {
            display: none;
        }

        #auth-message {
            color: #e74c3c;
            min-height: 20px;
        }

        #toggle-auth {
            background-color: #2980b9;
        }

        #toggle-auth:hover {
            background-color: #2471a3;
        }

        /* Google auth button */
        .social-auth-divider {
            display: flex;
            align-items: center;
            text-align: center;
            margin: 15px 0;
            color: #777;
        }

        .social-auth-divider::before,
        .social-auth-divider::after {
            content: '';
            flex: 1;
            border-bottom: 1px solid #ddd;
        }

        .social-auth-divider span {
            padding: 0 10px;
            font-size: 14px;
        }

        .google-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: white;
            color: #444;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px 15px;
            margin-bottom: 15px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
            width: 100%;
        }

        .google-btn:hover {
            background-color: #f8f8f8;
            border-color: #c6c6c6;
        }

        .google-icon {
            display: inline-block;
            width: 20px;
            height: 20px;
            margin-right: 10px;
            background-image: url('data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><path fill="%23EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"/><path fill="%234285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/><path fill="%23FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"/><path fill="%2334A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/><path fill="none" d="M0 0h48v48H0z"/></svg>');
            background-repeat: no-repeat;
            background-size: contain;
        }

        #guest-play {
            background-color: #7f8c8d;
        }

        #guest-play:hover {
            background-color: #6c7a7d;
        }

        /* Game container styles */
        #game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
        }

        #menu {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            z-index: 10;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        #menu h1 {
            color: #4CAF50;
            margin-bottom: 20px;
            font-size: 48px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        #playerName {
            padding: 10px;
            width: 100%;
            margin-bottom: 15px;
            border: 2px solid #4CAF50;
            border-radius: 5px;
            font-size: 16px;
        }

        #startButton, #logout-button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }

        #startButton {
            background-color: #4CAF50;
            color: white;
        }

        #startButton:hover {
            background-color: #45a049;
        }

        #logout-button {
            background-color: #e74c3c;
            color: white;
        }

        #logout-button:hover {
            background-color: #c0392b;
        }

        #gameCanvas {
            display: block;
            background-color: #111;
            width: 100%;
            height: 100%;
        }

        #scoreboard {
            position: absolute;
            top: 20px;
            right: 20px;
            background-color: rgba(255, 255, 255, 0.8);
            padding: 15px;
            border-radius: 8px;
            max-width: 200px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }

        #scoreboard h2, #scoreboard h3 {
            color: #4CAF50;
            margin-bottom: 10px;
        }

        #leaderboard {
            list-style: none;
        }

        #leaderboard li {
            margin-bottom: 5px;
            padding: 5px;
            border-bottom: 1px solid #ddd;
        }

        #highscores {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 10px;
            z-index: 20;
            width: 300px;
            max-height: 400px;
            overflow-y: auto;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        }

        #highscores h2 {
            color: #4CAF50;
            margin-bottom: 15px;
            text-align: center;
        }

        #highscores-list {
            list-style: none;
        }

        #highscores-list li {
            padding: 10px;
            margin-bottom: 5px;
            background-color: #f8f8f8;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
        }

        #close-highscores {
            display: block;
            margin: 15px auto 0;
            padding: 8px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        #show-highscores {
            position: absolute;
            bottom: 20px;
            right: 20px;
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            z-index: 5;
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <div id="auth-container">
        <div id="auth-menu">
            <h1>Snake.io</h1>
            <div id="auth-form">
                <div id="signup-form">
                    <h2>Sign Up</h2>
                    <input type="email" id="signup-email" placeholder="Email">
                    <input type="password" id="signup-password" placeholder="Password">
                    <button id="signup-button">Sign Up</button>
                </div>
                <div id="login-form">
                    <h2>Login</h2>
                    <input type="email" id="login-email" placeholder="Email">
                    <input type="password" id="login-password" placeholder="Password">
                    <button id="login-button">Login</button>
                </div>
                <p id="auth-message"></p>
                <button id="toggle-auth">Switch to Login</button>
                
                <!-- Google Auth Button -->
                <div class="social-auth-divider">
                    <span>or</span>
                </div>
                <button id="google-signin" class="google-btn" onclick="directPlayWithoutAuth()">
                    <span class="google-icon"></span>
                    <span>Continue with Google</span>
                </button>
                
                <button id="guest-play" onclick="directPlayWithoutAuth(); return false;">
                    Play as Guest
                </button>
            </div>
        </div>
    </div>

    <div id="game-container" class="hidden">
        <div id="menu">
            <h1>Snake.io</h1>
            <input type="text" id="playerName" placeholder="Enter your name">
            <button id="startButton">Play</button>
            <button id="logout-button">Logout</button>
        </div>
        <canvas id="gameCanvas"></canvas>
        <div id="scoreboard">
            <h2>Score: <span id="score">0</span></h2>
            <h3>Leaderboard</h3>
            <ul id="leaderboard"></ul>
        </div>
        <div id="highscores" class="hidden">
            <h2>Global Highscores</h2>
            <ul id="highscores-list"></ul>
            <button id="close-highscores">Close</button>
        </div>
        <button id="show-highscores">Highscores</button>
    </div>
    
    <script>
        // Game variables
        let canvas, ctx, menu, startButton, playerNameInput, scoreDisplay, leaderboardList, 
            highscoresDiv, highscoresList, showHighscoresButton, closeHighscoresButton;
        
        // Game state
        let gameRunning = false;
        let foodItems = [];
        let player = null;
        let aiSnakes = [];
        let score = 0;
        let lastTime = 0;
        let frameCount = 0;
        let cameraZoom = 1;
        let mousePosition = { x: 0, y: 0 };
        
        // Colors
        const COLORS = [
            '#FF5733', '#33FF57', '#3357FF', '#F3FF33', '#FF33F3',
            '#33FFF3', '#FF8C33', '#8CFF33', '#338CFF', '#FF338C'
        ];
        
        // Auth elements
        const authContainer = document.getElementById('auth-container');
        const gameContainer = document.getElementById('game-container');
        const signupForm = document.getElementById('signup-form');
        const loginForm = document.getElementById('login-form');
        const toggleAuthButton = document.getElementById('toggle-auth');
        const guestPlayButton = document.getElementById('guest-play');
        const googleSignInButton = document.getElementById('google-signin');
        const authMessage = document.getElementById('auth-message');
        
        // Play as guest
        function playAsGuest() {
            console.log('Play as guest clicked');
            authContainer.classList.add('hidden');
            gameContainer.classList.remove('hidden');
            
            // Initialize game after showing game container
            initializeGame();
        }
        
        // Initialize all event listeners
        function initializeEventListeners() {
            // Auth event listeners
            toggleAuthButton.addEventListener('click', function() {
                if (signupForm.style.display === 'none') {
                    signupForm.style.display = 'flex';
                    loginForm.style.display = 'none';
                    toggleAuthButton.textContent = 'Switch to Login';
                } else {
                    signupForm.style.display = 'none';
                    loginForm.style.display = 'flex';
                    toggleAuthButton.textContent = 'Switch to Sign Up';
                }
            });
            
            guestPlayButton.addEventListener('click', playAsGuest);
        }
        
        // Initialize game components
        function initializeGame() {
            // Get game elements
            canvas = document.getElementById('gameCanvas');
            ctx = canvas.getContext('2d');
            menu = document.getElementById('menu');
            startButton = document.getElementById('startButton');
            playerNameInput = document.getElementById('playerName');
            scoreDisplay = document.getElementById('score');
            leaderboardList = document.getElementById('leaderboard');
            highscoresDiv = document.getElementById('highscores');
            highscoresList = document.getElementById('highscores-list');
            showHighscoresButton = document.getElementById('show-highscores');
            closeHighscoresButton = document.getElementById('close-highscores');
            
            // Set canvas size
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            // Set mouse position center
            mousePosition = { x: canvas.width / 2, y: canvas.height / 2 };
            
            // Add game event listeners
            startButton.addEventListener('click', startGame);
            window.addEventListener('resize', resizeCanvas);
            window.addEventListener('mousemove', updateMousePosition);
            showHighscoresButton.addEventListener('click', function() {
                highscoresDiv.classList.remove('hidden');
            });
            closeHighscoresButton.addEventListener('click', function() {
                highscoresDiv.classList.add('hidden');
            });
            document.getElementById('logout-button').addEventListener('click', function() {
                gameRunning = false;
                gameContainer.classList.add('hidden');
                authContainer.classList.remove('hidden');
            });
        }
        
        // Helper functions
        function getRandomPosition(minDistance = 100) {
            // Get position away from player if exists
            const x = Math.random() * (canvas.width * 3) - canvas.width;
            const y = Math.random() * (canvas.height * 3) - canvas.height;
            
            if (player) {
                const dx = player.segments[0].x - x;
                const dy = player.segments[0].y - y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance < minDistance) {
                    return getRandomPosition(minDistance);
                }
            }
            
            return { x, y };
        }
        
        function getRandomColor() {
            return COLORS[Math.floor(Math.random() * COLORS.length)];
        }
        
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        
        function updateMousePosition(e) {
            mousePosition.x = e.clientX;
            mousePosition.y = e.clientY;
        }
        
        // Snake class
        class Snake {
            constructor(x, y, color, name, isPlayer = false) {
                this.segments = [{ x, y }];
                this.color = color;
                this.name = name;
                this.velocity = { x: 0, y: 0 };
                this.speed = 3;
                this.segmentSize = 15;
                this.segmentSpacing = 5;
                this.segmentTargets = 10; // Starting length
                this.isPlayer = isPlayer;
                this.angle = 0;
                this.targetAngle = 0;
                this.turnSpeed = 0.1;
                this.alive = true;
            }
            
            update(deltaTime) {
                if (!this.alive) return;
                
                // Update target angle
                if (this.isPlayer) {
                    // Calculate angle to mouse
                    const dx = mousePosition.x - canvas.width / 2;
                    const dy = mousePosition.y - canvas.height / 2;
                    this.targetAngle = Math.atan2(dy, dx);
                } else {
                    // AI movement logic
                    // Randomly change direction occasionally
                    if (Math.random() < 0.02) {
                        this.targetAngle += (Math.random() - 0.5) * Math.PI / 2;
                    }
                    
                    // Avoid walls - simple boundary check
                    const head = this.segments[0];
                    const margin = 200;
                    const worldSize = Math.max(canvas.width, canvas.height) * 2;
                    
                    if (head.x < -worldSize + margin) this.targetAngle = 0;
                    if (head.x > worldSize - margin) this.targetAngle = Math.PI;
                    if (head.y < -worldSize + margin) this.targetAngle = Math.PI / 2;
                    if (head.y > worldSize - margin) this.targetAngle = -Math.PI / 2;
                    
                    // Move toward food if nearby
                    let closestFood = null;
                    let closestDistance = 200; // Detection radius
                    
                    for (const food of foodItems) {
                        const dx = food.x - head.x;
                        const dy = food.y - head.y;
                        const distance = Math.sqrt(dx * dx + dy * dy);
                        
                        if (distance < closestDistance) {
                            closestFood = food;
                            closestDistance = distance;
                        }
                    }
                    
                    if (closestFood) {
                        const dx = closestFood.x - head.x;
                        const dy = closestFood.y - head.y;
                        this.targetAngle = Math.atan2(dy, dx);
                    }
                }
                
                // Smooth angle change
                const angleDiff = (this.targetAngle - this.angle + Math.PI * 3) % (Math.PI * 2) - Math.PI;
                this.angle += angleDiff * this.turnSpeed;
                
                // Update velocity
                this.velocity.x = Math.cos(this.angle) * this.speed;
                this.velocity.y = Math.sin(this.angle) * this.speed;
                
                // Move head
                const newHead = {
                    x: this.segments[0].x + this.velocity.x,
                    y: this.segments[0].y + this.velocity.y
                };
                
                this.segments.unshift(newHead);
                
                // Remove excess segments if snake is longer than it should be
                if (this.segments.length > this.segmentTargets) {
                    this.segments = this.segments.slice(0, this.segmentTargets);
                }
                
                // Check for food collision
                this.checkFoodCollision();
                
                // Check for collision with other snakes
                this.checkSnakeCollisions();
            }
            
            checkFoodCollision() {
                const head = this.segments[0];
                const eatDistance = this.segmentSize;
                
                for (let i = foodItems.length - 1; i >= 0; i--) {
                    const food = foodItems[i];
                    const dx = head.x - food.x;
                    const dy = head.y - food.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance < eatDistance) {
                        // Eat food
                        this.segmentTargets += food.value;
                        if (this.isPlayer) {
                            score += food.value;
                            scoreDisplay.textContent = score;
                        }
                        
                        // Remove food
                        foodItems.splice(i, 1);
                        
                        // Spawn new food
                        spawnFood();
                    }
                }
            }
            
            checkSnakeCollisions() {
                if (!this.alive) return;
                
                const head = this.segments[0];
                
                // Check collision with other snakes
                const snakesToCheck = this.isPlayer ? aiSnakes : [player, ...aiSnakes.filter(s => s !== this)];
                
                for (const otherSnake of snakesToCheck) {
                    if (!otherSnake || !otherSnake.alive) continue;
                    
                    // Start checking from segment 1 if it's the same snake
                    const startSegment = otherSnake === this ? 1 : 0;
                    
                    for (let i = startSegment; i < otherSnake.segments.length; i++) {
                        const segment = otherSnake.segments[i];
                        const dx = head.x - segment.x;
                        const dy = head.y - segment.y;
                        const distance = Math.sqrt(dx * dx + dy * dy);
                        
                        if (distance < this.segmentSize * 0.8) {
                            this.die();
                            return;
                        }
                    }
                }
            }
            
            die() {
                this.alive = false;
                
                // Convert each segment to food
                for (let i = 0; i < this.segments.length; i += 3) {
                    foodItems.push({
                        x: this.segments[i].x,
                        y: this.segments[i].y,
                        color: this.color,
                        size: 5,
                        value: 1
                    });
                }
                
                if (this.isPlayer) {
                    // End game after short delay
                    setTimeout(() => {
                        gameRunning = false;
                        menu.classList.remove('hidden');
                    }, 2000);
                } else {
                    // Replace AI snake
                    setTimeout(() => {
                        const index = aiSnakes.indexOf(this);
                        if (index !== -1) {
                            const pos = getRandomPosition(300);
                            aiSnakes[index] = createAISnake(pos.x, pos.y);
                        }
                    }, 5000);
                }
            }
            
            draw(ctx, offsetX, offsetY) {
                if (!this.alive) return;
                
                // Draw each segment
                for (let i = this.segments.length - 1; i >= 0; i--) {
                    const segment = this.segments[i];
                    const size = this.segmentSize * (i === 0 ? 1.2 : 1); // Slightly bigger head
                    
                    // Calculate size based on position in snake body
                    const sizeFactor = 0.8 + (1 - i / this.segments.length) * 0.4;
                    const adjustedSize = size * sizeFactor;
                    
                    ctx.beginPath();
                    ctx.arc(
                        segment.x - offsetX,
                        segment.y - offsetY,
                        adjustedSize,
                        0,
                        Math.PI * 2
                    );
                    ctx.fillStyle = this.color;
                    ctx.fill();
                    
                    // Add eyes to the head
                    if (i === 0) {
                        // Left eye
                        const leftEyeX = segment.x - offsetX + Math.cos(this.angle - Math.PI/4) * (size * 0.5);
                        const leftEyeY = segment.y - offsetY + Math.sin(this.angle - Math.PI/4) * (size * 0.5);
                        
                        // Right eye
                        const rightEyeX = segment.x - offsetX + Math.cos(this.angle + Math.PI/4) * (size * 0.5);
                        const rightEyeY = segment.y - offsetY + Math.sin(this.angle + Math.PI/4) * (size * 0.5);
                        
                        // Draw eyes
                        ctx.beginPath();
                        ctx.arc(leftEyeX, leftEyeY, size * 0.3, 0, Math.PI * 2);
                        ctx.fillStyle = 'white';
                        ctx.fill();
                        
                        ctx.beginPath();
                        ctx.arc(rightEyeX, rightEyeY, size * 0.3, 0, Math.PI * 2);
                        ctx.fillStyle = 'white';
                        ctx.fill();
                        
                        // Pupils
                        ctx.beginPath();
                        ctx.arc(leftEyeX + Math.cos(this.angle) * 2, leftEyeY + Math.sin(this.angle) * 2, size * 0.15, 0, Math.PI * 2);
                        ctx.fillStyle = 'black';
                        ctx.fill();
                        
                        ctx.beginPath();
                        ctx.arc(rightEyeX + Math.cos(this.angle) * 2, rightEyeY + Math.sin(this.angle) * 2, size * 0.15, 0, Math.PI * 2);
                        ctx.fillStyle = 'black';
                        ctx.fill();
                    }
                }
                
                // Draw name
                if (this.segments.length > 0) {
                    const head = this.segments[0];
                    ctx.font = '14px Arial';
                    ctx.fillStyle = 'white';
                    ctx.textAlign = 'center';
                    ctx.fillText(this.name, head.x - offsetX, head.y - offsetY - this.segmentSize - 10);
                }
            }
        }
        
        // Game functions
        function startGame() {
            // Hide menu
            menu.classList.add('hidden');
            
            // Reset game state
            foodItems = [];
            aiSnakes = [];
            score = 0;
            scoreDisplay.textContent = score;
            gameRunning = true;
            
            // Create player
            const playerName = playerNameInput.value.trim() || 'Player';
            const playerColor = getRandomColor();
            player = new Snake(0, 0, playerColor, playerName, true);
            
            // Create AI snakes
            for (let i = 0; i < 10; i++) {
                const pos = getRandomPosition(300);
                aiSnakes.push(createAISnake(pos.x, pos.y));
            }
            
            // Spawn initial food
            for (let i = 0; i < 200; i++) {
                spawnFood();
            }
            
            // Start game loop
            requestAnimationFrame(gameLoop);
        }
        
        function createAISnake(x, y) {
            const color = getRandomColor();
            const namePrefix = ['Hungry', 'Sneaky', 'Speedy', 'Slimy', 'Slithery', 'Wiggly'];
            const nameSuffix = ['Snake', 'Python', 'Cobra', 'Viper', 'Worm', 'Eel'];
            const name = `${namePrefix[Math.floor(Math.random() * namePrefix.length)]} ${nameSuffix[Math.floor(Math.random() * nameSuffix.length)]}`;
            
            return new Snake(x, y, color, name, false);
        }
        
        function spawnFood() {
            const pos = getRandomPosition();
            const size = Math.random() < 0.1 ? 10 : 5; // Occasionally spawn larger food
            const value = size === 10 ? 3 : 1;
            
            foodItems.push({
                x: pos.x,
                y: pos.y,
                color: getRandomColor(),
                size: size,
                value: value
            });
        }
        
        function updateLeaderboard() {
            // Clear current leaderboard
            leaderboardList.innerHTML = '';
            
            // Create array of all snakes
            const allSnakes = [player, ...aiSnakes].filter(snake => snake && snake.alive);
            
            // Sort by length
            allSnakes.sort((a, b) => b.segmentTargets - a.segmentTargets);
            
            // Display top 5
            for (let i = 0; i < Math.min(5, allSnakes.length); i++) {
                const snake = allSnakes[i];
                const listItem = document.createElement('li');
                listItem.style.color = snake.color;
                listItem.textContent = `${i + 1}. ${snake.name}: ${snake.segmentTargets}`;
                leaderboardList.appendChild(listItem);
            }
        }
        
        function drawBackground(ctx, offsetX, offsetY) {
            // Draw grid
            ctx.strokeStyle = '#222';
            ctx.lineWidth = 1;
            
            const gridSize = 50;
            const offsetXMod = offsetX % gridSize;
            const offsetYMod = offsetY % gridSize;
            
            // Horizontal lines
            for (let y = -offsetYMod; y < canvas.height; y += gridSize) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();
            }
            
            // Vertical lines
            for (let x = -offsetXMod; x < canvas.width; x += gridSize) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, canvas.height);
                ctx.stroke();
            }
        }
        
        function gameLoop(timestamp) {
            // Calculate delta time
            const deltaTime = timestamp - lastTime;
            lastTime = timestamp;
            
            // Update game state
            if (gameRunning) {
                // Clear canvas
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // Calculate camera position (player centered)
                let cameraX = 0;
                let cameraY = 0;
                
                if (player && player.alive) {
                    cameraX = player.segments[0].x - canvas.width / 2;
                    cameraY = player.segments[0].y - canvas.height / 2;
                    
                    // Update player
                    player.update(deltaTime);
                }
                
                // Draw background
                drawBackground(ctx, cameraX, cameraY);
                
                // Update and draw AI snakes
                for (const snake of aiSnakes) {
                    if (snake.alive) {
                        snake.update(deltaTime);
                        snake.draw(ctx, cameraX, cameraY);
                    }
                }
                
                // Draw food
                for (const food of foodItems) {
                    ctx.beginPath();
                    ctx.arc(
                        food.x - cameraX,
                        food.y - cameraY,
                        food.size,
                        0,
                        Math.PI * 2
                    );
                    ctx.fillStyle = food.color;
                    ctx.fill();
                }
                
                // Draw player on top
                if (player && player.alive) {
                    player.draw(ctx, cameraX, cameraY);
                }
                
                // Update leaderboard every 30 frames
                frameCount++;
                if (frameCount % 30 === 0) {
                    updateLeaderboard();
                    
                    // Spawn new food occasionally
                    if (foodItems.length < 300 && Math.random() < 0.3) {
                        spawnFood();
                    }
                }
                
                // Continue game loop
                requestAnimationFrame(gameLoop);
            }
        }
        
        // Initialize when the page is loaded
        window.addEventListener('DOMContentLoaded', function() {
            console.log('DOM fully loaded');
            initializeEventListeners();
        });
    </script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script>
        // Google sign in handler - load this after everything else
        window.onload = function() {
            // Initialize Google Sign-In button if it exists
            const googleSignInButton = document.getElementById('google-signin');
            if (googleSignInButton) {
                googleSignInButton.addEventListener('click', function() {
                    // This should be shown on a successful sign-in
                    console.log('Google sign-in clicked - redirecting to game');
                    // For now, just show game container
                    document.getElementById('auth-container').classList.add('hidden');
                    document.getElementById('game-container').classList.remove('hidden');
                    
                    // Initialize game
                    if (typeof initializeGame === 'function') {
                        initializeGame();
                    }
                });
            }
        };
    </script>
    <script>
        // Direct play function for all authentication buttons
        function directPlayWithoutAuth() {
            document.getElementById('auth-container').classList.add('hidden');
            document.getElementById('game-container').classList.remove('hidden');
            if (typeof initializeGame === 'function') {
                initializeGame();
            }
            return false;
        }
    </script>
</body>
</html> 